<!DOCTYPE html>
<html>
    <head>
        <title>명품 브랜드 테스트</title>
		<description>구글 Teachable Machine AI를 통해서 내가 입은 옷 스타일이 어떤 명품 브랜드의 스타일과 유사한지 알아보자.</description>
		<meta property="og:title" content="내 패션이 어떤 명품 브랜드 스타일인지 확인해보기">
		<meta property="og:description" content="구글 Teachable Machine AI를 통해서 내가 입은 옷 스타일이 어떤 명품 브랜드의 스타일과 유사한지 알아보자.">
		<meta property="og:image" content="favicon.ico">
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
		<link rel="icon" href="favicon.ico" type="image/x-icon">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="style.css" />
        <meta name="naver-site-verification" content="ac6469ea3b0f06392d94df236f8e499bf010f308" />
    </head>
    <body>
        <h1 class="titlebrand">명품 브랜드 테스트</h1>
        <h2 class="subtitle">나의 패션은 어떤 명품 스타일일까?</h2>

        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <div class="file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    옷을 입은 전신 사진을<br />
                    업로드해주세요.<br /><br />
                    얼굴이 안 나오게 자르면<br />
                    더 정확합니다.
                    <div class="drag-text" id="NEVERSAVE">
                        파일은 그 어디에도 저장되지 않습니다.
                    </div>
                </div>
            </div>
            <div class="file-upload-content">
                <img class="file-upload-image" id="face-image" src="#" alt="your image" />
                <br />
                <div class="spinner-border text-light m-3" role="status">
                    <div class="visually-hidden">Loading...</div>
                </div>
                <p class="result-message"></p>
                <div id="label-container"></div>
                <div class="image-title-wrap">
                    <button type="button" onclick="removeUpload()" class="remove-image">
                        다른 사진으로 다시하기
                    </button>
                </div>
            </div>
            <div class="home-button"></div>
        </div>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script>
            var title = '';
            const prediction = [];
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();

                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();

                        $('.image-title').html(input.files[0].name);
                    };

                    reader.readAsDataURL(input.files[0]);
                    $('.spinner-border').show();
                    init().then(() => {
                        predict();
                    });
                } else {
                    removeUpload();
                }
            }

            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.result-message').empty();
                $('#label-container').empty();
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>
        <script type="text/javascript">
            // More API functions here:
            // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

            // the link to your model provided by Teachable Machine export panel
            const URL = 'https://teachablemachine.withgoogle.com/models/WQfvGevL2/';

            let model, webcam, labelContainer, maxPredictions;

            // Load the image model and setup the webcam
            async function init() {
                const modelURL = URL + 'model.json';
                const metadataURL = URL + 'metadata.json';

                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                labelContainer = document.getElementById('label-container');
                for (let i = 0; i < maxPredictions; i++) {
                    // and class labels
                    labelContainer.appendChild(document.createElement('div'));
                }
            }
            // run the webcam image through the image model

            async function predict() {
                $('.spinner-border').hide();
                // predict can take in an image, video or canvas html element
                var image = document.getElementById('face-image');
                const prediction = await model.predict(image, false);
                prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                var title =
                    "<div class='result-brand'> 당신은 " +
                    prediction[0].className +
                    ' 스타일!</div>';
                $('.result-message').html(title);
                for (let i = 0; i < maxPredictions; i++) {
                    if (prediction[i].probability.toFixed(2) > 0.01) {
                        if (prediction[i].probability.toFixed(2) < 0.1) {
                            var ratio = prediction[i].probability.toFixed(2) * 100;
                            ratio = Math.round(ratio);
                            const percentbar =
                                '<div class="result-brands">' +
                                prediction[i].className +
                                '</div><div class="progress"><div class="progress-bar progress-bar-animated bg-warning" role="progressbar" style="width: ' +
                                ratio +
                                '%;" aria-valuenow="' +
                                ratio +
                                '" aria-valuemin="0" aria-valuemax="100"></div>' +
                                ratio +
                                '%</div>';
                            $('#label-container').append(percentbar);
                        } else {
                            var ratio = prediction[i].probability.toFixed(2) * 100;
                            ratio = Math.round(ratio);
                            const percentbar =
                                '<div class="result-brands">' +
                                prediction[i].className +
                                '</div><div class="progress"><div class="progress-bar progress-bar-animated bg-warning" role="progressbar" style="width: ' +
                                ratio +
                                '%;" aria-valuenow="' +
                                ratio +
                                '" aria-valuemin="0" aria-valuemax="100">' +
                                ratio +
                                '%</div></div>';
                            $('#label-container').append(percentbar);
                        }
                    }
                    // const classPrediction =
                    //     prediction[i].className + ': ' + prediction[i].probability.toFixed(2);
                    // labelContainer.childNodes[i].innerHTML = classPrediction;
                }
            }
        </script>
        <script
            type="text/javascript"
            src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-6076afaae3d25100"
        ></script>

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <div class="addthis_inline_share_toolbox_ktgm m-3"></div>
    </body>
    <!-- image upload Copyright (c) 2021 by Aaron Vanston (https://codepen.io/aaronvanston/pen/yNYOXR) -->
</html>
